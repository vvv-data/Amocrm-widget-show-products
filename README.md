# Amocrm-widget-show-products
Виджет (приватная интеграция) добавляет кнопку в карточке сделки в правой колонке. При клике на эту кнопку в модальном окне выводится список всех товаров этой сделки.

![readmy_9](https://user-images.githubusercontent.com/106067946/183896980-5a2912db-7962-4a67-9c5e-d5aed4b96bcc.jpg)

Получение товаров происходит по API - oAuth, через ваш сторонний сервер.
Этот виджет для примера, как можно взаимодействовать из админки amocrm с их ip по oAuth авторизации, и не несет коммерческой ценности, т.к. товары и так можно посмотреть в соответствующей вкладке. 
### Для работы виджета используется официальная библиотека amocrm
https://github.com/amocrm/amocrm-api-php
## Установка
### Установка js виджета
Создайте архив zip из содержимого папки [widget] и назовите его widget.zip

Загрузите в amocrm согласно их инструкции https://www.amocrm.ru/developers/content/integrations/upload

В поле URL редиректа вставте https://yourwebsite.ru/amocrm/login.php, где yourwebsite.ru название вашего сайта

Заполните все Settings поля виджета, "Secret key:" скопируйте во вкладке "Keys and scopes" 
### Установка на ваш сайт


Для установки вам потребуется сайт с поддержкой php 7.1+, например https://yourwebsite.ru/
Загрузите в корень вашего сайта папку со скриптами [amocrm], ее URL: https://yourwebsite.ru/amocrm/

Установите в эту же папку библиотеку https://github.com/amocrm/amocrm-api-php с помощью composer, как у них рекомендуется.

Composer создает папку [vendor], она должна находиться внутри папки [amocrm]
### Должно получится так:
![readmy_2](https://user-images.githubusercontent.com/106067946/183854353-3ae92c2a-0b39-421a-9d8b-c79cbda7e7fe.jpg)

Создайте внутри папки [amocrm] - папку [tmp] и дайте ей права на запись, но закройте ее от внешнего просмотра (например с помощью .htases). В нее будет записываться файл с токеном. 

Должно получится так:

![readmy_1](https://user-images.githubusercontent.com/106067946/183855047-a0450031-83ea-4330-9499-f25545530bc4.jpg)

Заполните файл config.php своими данными
```
/amocrm/config.php
```

## Получите токен
Откройте на вашем сайте страницу https://yourwebsite.ru/amocrm/login.php

Нажмите на кнопку:

![readmy_5](https://user-images.githubusercontent.com/106067946/183863722-b2ae0445-ebc1-4233-9eb1-fcff2b01def7.jpg)

В открывшемся окне выберите ваш аккаунт и нажмите разрешить:
![readmy_6](https://user-images.githubusercontent.com/106067946/183867260-763c9e03-dd27-4979-a75b-135da22a65f5.jpg)

Если все прошло успешно вы увидите Hello {ваше имя}

В папке [tmp] на вашем сайте должен появится файл с токеном.

Если все прошло ок, то в карточке сделки при клике на кнопку виджета, должны вывестись все товары этой сделки.


